#!/usr/bin/env modbuild

pbuild::set_download_url "https://netcologne.dl.sourceforge.net/project/boost/boost/$V/boost_${V_MAJOR}_${V_MINOR}_${V_PATCHLVL}.tar.gz"

pbuild::add_to_group 'MPI'

pbuild::add_patch "files/context-Jamfile.patch"

BOOST_BUILD_PATH="${BUILD_DIR}"

declare -x TOOLSET=''

pbuild::pre_configure() {
	case "${COMPILER}" in
	gcc )
	        TOOLSET=gcc
	        ;;
	* )
	        std::die 1 "Unsupported compiler!"
	        ;;
	esac
}

pbuild::configure() {
        cd "${SRC_DIR}"
        ./bootstrap.sh \
                --prefix="${PREFIX}" \
                --with-toolset=${TOOLSET} \
                --without-libraries=python \
                || exit 1
        echo "using mpi ;" >> "./project-config.jam"
}

pbuild::compile() {
        cd "${SRC_DIR}"
        ./b2  \
                --build-dir="${BUILD_DIR}" \
                --layout=system \
                --without-python \
                toolset=${TOOLSET} \
                variant=release \
                link=shared,static \
                threading=multi \
                install -j 3 \
                || exit 1
}

pbuild::install() {
        :
}

