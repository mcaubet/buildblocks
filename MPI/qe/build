#!/usr/bin/env modbuild

pbuild::set_download_url "https://github.com/QEF/q-e/archive/$P-$V.tar.gz"

pbuild::add_to_group 'MPI'

pbuild::install_docfiles License README.md CONTRIBUTING.md

pbuild::compile_in_sourcetree

pbuild::pre_configure() {
        pbuild::add_configure_args "--enable-openmp"
        pbuild::add_configure_args "--with-hdf5"

        case "${COMPILER}" in
                pgi )
                        pbuild::add_configure_args "--with-cuda=$CUDA_HOME"
                        pbuild::add_configure_args "--with-cuda-cc=60"
                        pbuild::add_configure_args "--with-cuda-mpi=yes"
                        pbuild::add_configure_args "--enable-openacc"
                        pbuild::add_configure_args "--with-cuda-runtime=8+"
                        ;;
        esac

}

pbuild::compile() {
        make all
        make install
}

pbuild::install() {
	:
}

