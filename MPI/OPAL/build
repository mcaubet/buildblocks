#!/usr/bin/env modbuild

pbuild::set_download_url "http://amas.web.psi.ch/Downloads/$P/src/$P-${V_PKG}.tar.xz"
pbuild::add_to_group 'MPI'

pbuild::pre_configure_Linux() {
	if (( V_MAJOR < 2)); then
		pbuild::add_configure_args '-DENABLE_DKS=ON'
	fi
}

pbuild::pre_configure() {
	pbuild::add_configure_args "-DCMAKE_BUILD_TYPE=Release"
	if [[ $V == 2.2.1-1_slurm ]]; then
		:
	else
		pbuild::add_configure_args "-DENABLE_SAAMG_SOLVER=TRUE"
		pbuild::add_configure_args "-DENABLE_AMR=TRUE"
		pbuild::add_configure_args "-DENABLE_AMR_MG_SOLVER=TRUE"
	fi
	if (( V_MAJOR >= 2021 )); then
		pbuild::add_configure_args "-DBUILD_FOR_PRODUCTION=TRUE"
		pbuild::add_configure_args "-DENABLE_BANDRF=TRUE"
		pbuild::add_configure_args "-DENABLE_OPAL_FEL=TRUE"
	fi
}

