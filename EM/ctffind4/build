#!/usr/bin/env modbuild

# Binary distribution with manual installation. See README.md

pbuild::post_prep() {
    cp "$BUILDBLOCK_DIR/ctffind_wrapper.c" "$BUILD_DIR/"
    sed -i "s|@CTFFINDPATH@|$PREFIX/bin/ctffind.orig|" "$BUILD_DIR/ctffind_wrapper.c"
}

pbuild::compile() {
    gcc -Wall -pedantic -o ctffind_wrapper ctffind_wrapper.c
}

pbuild::install() {
    mkdir -p "$PREFIX/bin"
    mv "$SRC_DIR/"* "$PREFIX/bin"

    # swap the binary with the wrapper
    mv "$PREFIX/bin/ctffind" "$PREFIX/bin/ctffind.orig"
    mv "$BUILD_DIR/ctffind_wrapper" "$PREFIX/bin/ctffind"
}

