#!/usr/bin/env modbuild

pbuild::set_download_url "http://amas.web.psi.ch/Downloads/$P/$P-${V_PKG}.tar.gz"
pbuild::add_to_group 'HDF5'
pbuild::install_docfiles 'AUTHORS' 'COPYING'

if [[ ${V_MAJOR} == 1 ]]; then
	pbuild::compile_in_sourcetree
fi

pbuild::post_prep() {
	./autogen.sh
}

pbuild::pre_configure() {
	pbuild::add_configure_args "--enable-parallel"
	pbuild::add_configure_args "--enable-debug"
	pbuild::add_configure_args "--enable-shared"
	pbuild::add_configure_args "--with-hdf5=$HDF5_PREFIX"
	pbuild::add_configure_args "--with-pic"
	if (( V_MAJOR >= 2 )); then
		: pbuild::add_configure_args "--enable-python"
	fi
	case "${COMPILER}" in
		"clang-macos" )
			:
			;;
		* )
			pbuild::add_configure_args '--enable-fortran'
			;;
	esac
}

pbuild::compile() {
	make -C src
	make -C tools 
}

pbuild::install() {
	make -C src install
	make -C tools install
}

