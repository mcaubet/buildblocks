#!/usr/bin/env modbuild

pbuild::set_download_url "https://www.unidata.ucar.edu/downloads/$P/ftp/$P-$V.tar.gz"

pbuild::configure() {
	CC=$MPICC
	CXX=$MPICXX
	F77=$MPIF77
	F90=$MPIF90
	FC=$MPIFC
	FORTRAN=$MPIFORTRAN
	"${SRC_DIR}"/configure \
		--prefix="${PREFIX}" \
		--enable-netcdf-4 \
		--with-pic \
		--enable-pnetcdf \
		--enable-remote-fortran-bootstrap \
		|| exit 1
}

pbuild::compile() {
	make check
	make 
	make install
	# configure requires libnetcdf
	LIBRARY_PATH+=":${BUILD_DIR}/liblib/.libs"
	LD_LIBRARY_PATH+=":${BUILD_DIR}/liblib/.libs"
	make build-netcdf-fortran
	make install-netcdf-fortran
}

pbuild::install() {
	:
}

pbuild::add_to_group 'HDF5'
pbuild::set_docfiles 'COPYRIGHT' 'README.md' 'RELEASE_NOTES.md'
pbuild::make_all

