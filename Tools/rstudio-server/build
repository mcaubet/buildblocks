#!/usr/bin/env modbuild

pbuild::configure() {
    # Detect OS
    source /etc/os-release
    echo "Detected OS: $ID ($VERSION_ID)"

    if [[ "$ID" == "sles" && "${VERSION_ID%%.*}" == "15" ]]; then
        OS_VERSION="opensuse15"
    else
        echo "Unsupported OS: $ID ($VERSION_ID)"
        exit 1
    fi

    # Download RPM
    FILE="rstudio-server-${V}-$(uname -i).rpm"
    URL="https://download2.rstudio.org/server/${OS_VERSION}/$(uname -i)/${FILE}"
    wget -q -O "${SRC_DIR}/${FILE}" "$URL"

    # Extract using rpm2cpio
    cd "$SRC_DIR" || exit 1
    rpm2cpio "$FILE" | cpio -idmv

    # Extract to $PREFIX
    cp -r "${SRC_DIR}/usr/lib/rstudio-server/" "$PREFIX/"
}

pbuild::compile(){
    :
}

pbuild::install(){
    :
}
